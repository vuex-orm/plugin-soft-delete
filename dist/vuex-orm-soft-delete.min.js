!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).VuexORMSoftDelete=t()}(this,function(){"use strict";var t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function n(e,s,l,a){return new(l=l||Promise)(function(n,t){function r(e){try{i(a.next(e))}catch(e){t(e)}}function o(e){try{i(a.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,o)}i((a=a.apply(e,s||[])).next())})}function a(n,r){var o,i,s,e,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,i&&(s=2&t[0]?i.return:t[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,i=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(s=0<(s=l.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){l.label=t[1];break}if(6===t[0]&&l.label<s[1]){l.label=s[1],s=t;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(t);break}s[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],i=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function r(s,e){var i=e.prototype.$fields;e.prototype.$fields=function(){var e,t=i.call(this),n=s.createConfig(this.$self().softDeleteConfig),r=n.key,o=n.flagName;return Object.assign({},t,((e={})[r]=this.$self().attr(null),e[o]=this.$self().attr(!1),e))};var o=e.prototype.$toJson;e.prototype.$toJson=function(){var e=o.call(this),t=s.createConfig(this.$self().softDeleteConfig);if(!0===t.exposeFlagsExternally)return e;var n=t.key,r=(e[n],t.flagName);e[r];return function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(e,["symbol"==typeof n?n:n+"","symbol"==typeof r?r:r+""])};var l=e.prototype.$fill;e.prototype.$fill=function(e){var t,n;if(l.call(this,e),e){var r=s.createConfig(this.$self().softDeleteConfig),o=r.key,i=r.flagName;this[o]=null!==(t=e[o])&&void 0!==t?t:null,this[i]=null!==(n=e[i])&&void 0!==n&&n}},e.prototype.$softDelete=function(){return n(this,void 0,void 0,function(){var t,n,r,o;return a(this,function(e){switch(e.label){case 0:return[4,this.$dispatch("softDelete",this.$self().getIdFromRecord(this))];case 1:return t=e.sent(),n=s.createConfig(this.$self().softDeleteConfig),r=n.key,o=n.flagName,this[r]=t[r],this[o]=t[o],[2,t]}})})},e.prototype.softDelete=function(){return"production"!==process.env.NODE_ENV&&console.warn("The `softDelete` instance method has been deprecated. Please use `$softDelete`."),this.$softDelete()},e.prototype.trashed=function(){var e=s.createConfig(this.$self().softDeleteConfig).flagName;return!0===this[e]},e.softDelete=function(e){return this.dispatch("softDelete",e)}}var o={key:"deleted_at",flagName:"$isDeleted",exposeFlagsExternally:!0,mutator:null},i=(e.prototype.createConfig=function(e){return t(t(t({},o),this.config),e)},e.prototype.plugin=function(){var s,e;r(this,this.model),(e=(s=this).query).prototype.softDeletesFilter=null,e.prototype.withTrashed=function(){return this.softDeletesFilter=!1,this},e.prototype.onlyTrashed=function(){return this.softDeletesFilter=!0,this},e.prototype.trashed=function(){return"production"!==process.env.NODE_ENV&&console.warn("The `trashed` method has been deprecated. Please use `onlyTrashed`."),this.onlyTrashed()},e.prototype.softDelete=function(t){var e,n=s.createConfig(this.model.softDeleteConfig),r=Date.now();r="function"==typeof n.mutator?n.mutator(r):r;var o=((e={})[n.key]=r,e[n.flagName]=!0,e);if(Array.isArray(t)){if(!this.model.isCompositePrimaryKey())return this.model.update({data:o,where:function(e){return t.includes(e[e.$primaryKey()])}});if(t.some(function(e){return Array.isArray(e)})){var i=t.map(function(e){return Array.isArray(e)&&JSON.stringify(e)}).filter(Boolean);return this.model.update({data:o,where:function(e){return i.includes(e.$id)}})}}return this.model.update({data:o,where:t})},e.prototype.allTrashed=function(){return this.onlyTrashed().get()},e.allTrashed=function(n){var r=this,e=n.$db().models();return Object.keys(e).reduce(function(e,t){return e[t]=new r(n,t).onlyTrashed().get(),e},{})},e.on("beforeSelect",function(t){var n=this;return t.filter(function(e){return!0===n.softDeletesFilter?e.trashed():!1===n.softDeletesFilter?t:!e.trashed()})}),function(o,e){var t=this;e.actions.softDelete=function(i,s){return n(t,void 0,void 0,function(){var t,n,r,o;return a(this,function(e){return t=i.state,n=t.$name,r=null!==(o=s.where)&&void 0!==o?o:s,[2,i.dispatch(t.$connection+"/softDelete",{entity:n,where:r},{root:!0})]})})},e.rootActions.softDelete=function(e,r){return n(this,void 0,void 0,function(){var t,n;return a(this,function(e){return t=r.entity,n=r.where,[2,new o.query(this,t).softDelete(n)]})})},e.getters.allTrashed=function(e,t,n,r){return function(){return r[e.$connection+"/allTrashed"](e.$name)}},e.rootGetters.allTrashed=function(e){var t=this;return function(e){return e?new o.query(t,e).allTrashed():o.query.allTrashed(t)}}}(this,this.modules)},e);function e(e,t){this.model=e.Model,this.query=e.Query,this.modules={actions:e.Actions,getters:e.Getters,rootGetters:e.RootGetters,rootActions:e.RootActions},this.config=this.createConfig(t)}return{install:function(e,t){new i(e,t).plugin()}}});