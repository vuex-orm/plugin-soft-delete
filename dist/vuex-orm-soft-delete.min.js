!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).VuexORMSoftDelete=e()}(this,function(){"use strict";var e=function(){return(e=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function l(t,s,a,l){return new(a=a||Promise)(function(r,e){function n(t){try{i(l.next(t))}catch(t){e(t)}}function o(t){try{i(l.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(n,o)}i((l=l.apply(t,s||[])).next())})}function f(r,n){var o,i,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(s=2&e[0]?i.return:e[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,e[1])).done)return s;switch(i=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,i=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=n.call(r,a)}catch(t){e=[6,t],i=0}finally{o=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function n(a,t){t.softDelete=function(t){return this.dispatch("softDelete",t)},t.prototype.$softDelete=function(i){return l(this,void 0,void 0,function(){var e,r,n,o;return f(this,function(t){switch(t.label){case 0:return[4,this.$dispatch("softDelete",this.$self().getIdFromRecord(this))];case 1:return(e=t.sent(),i)?(this.$fill(e.$getAttributes()),[2,this]):(r=a.createConfig(this.$self().softDeleteConfig),n=r.key,o=r.flagName,this[n]=e[n],this[o]=e[o],[2,e])}})})},t.prototype.$restore=function(s){return l(this,void 0,void 0,function(){var e,r,n,o,i;return f(this,function(t){switch(t.label){case 0:return e=a.createConfig(this.$self().softDeleteConfig),r=e.key,n=e.flagName,[4,this.$dispatch("update",{where:this.$self().getIdFromRecord(this),data:((i={})[r]=null,i[n]=!1,i)})];case 1:return(o=t.sent(),s)?(this.$fill(o.$getAttributes()),[2,this]):(this[r]=o[r],this[n]=o[n],[2,this])}})})},t.prototype.$trashed=function(){var t=a.createConfig(this.$self().softDeleteConfig).flagName;return!0===this[t]},t.prototype.softDelete=function(t){return"production"!==process.env.NODE_ENV&&console.warn("The `softDelete` instance method has been deprecated. Please use `$softDelete`."),this.$softDelete(t)};var i=t.prototype.$fields;t.prototype.$fields=function(){var t,e=i.call(this),r=a.createConfig(this.$self().softDeleteConfig),n=r.key,o=r.flagName;return Object.assign({},e,((t={})[n]=this.$self().attr(null),t[o]=this.$self().attr(!1),t))};var o=t.prototype.$toJson;t.prototype.$toJson=function(){var t=o.call(this),e=a.createConfig(this.$self().softDeleteConfig);if(!0===e.exposeFlagsExternally)return t;var r=e.key,n=(t[r],e.flagName);t[n];return function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r}(t,["symbol"==typeof r?r:r+"","symbol"==typeof n?n:n+""])}}var r={key:"deleted_at",flagName:"$isDeleted",exposeFlagsExternally:!0,mutator:null},o=(t.prototype.createConfig=function(t){return e(e(e({},r),this.config),t)},t.prototype.plugin=function(){var u,t,o,r;n(this,this.model),(t=(u=this).query).prototype.softDeletesFilter=null,t.prototype.withTrashed=function(){return this.softDeletesFilter=!1,this},t.prototype.onlyTrashed=function(){return this.softDeletesFilter=!0,this},t.prototype.trashed=function(){return"production"!==process.env.NODE_ENV&&console.warn("The `trashed` method has been deprecated. Please use `onlyTrashed`."),this.onlyTrashed()},t.prototype.softDelete=function(e){var t,r=u.createConfig(this.model.softDeleteConfig),n=r.key,o=r.flagName,i=r.mutator,s=Date.now();s="function"==typeof i?i(s):s;var a=((t={})[n]=s,t[o]=!0,t);if(Array.isArray(e)){if(!this.model.isCompositePrimaryKey())return this.model.update({data:a,where:function(t){return e.includes(t[t.$primaryKey()])}});if(e.some(function(t){return Array.isArray(t)})){var l=e.map(function(t){return Array.isArray(t)&&JSON.stringify(t)}).filter(Boolean);return this.model.update({data:a,where:function(t){return l.includes(t.$id)}})}}return this.model.update({data:a,where:e})},t.prototype.allTrashed=function(){return this.newQuery().onlyTrashed().get()},t.allTrashed=function(r){var n=this,t=r.$db().models();return Object.keys(t).reduce(function(t,e){return t[e]=new n(r,e).onlyTrashed().get(),t},{})},t.on("beforeSelect",function(e){var r=this;return e.filter(function(t){return!0===r.softDeletesFilter?t.$trashed():!1===r.softDeletesFilter?e:!t.$trashed()})}),function(t){var e=this;t.softDelete=function(i,s){return l(e,void 0,void 0,function(){var e,r,n,o;return f(this,function(t){return e=i.state,r=e.$name,n=null!==(o=s.where)&&void 0!==o?o:s,[2,i.dispatch(e.$connection+"/softDelete",{entity:r,where:n},{root:!0})]})})}}(this.actions),this.getters.allTrashed=function(t,e,r,n){return function(){return n[t.$connection+"/allTrashed"](t.$name)}},(o=this).rootActions.softDelete=function(t,n){return l(this,void 0,void 0,function(){var e,r;return f(this,function(t){return e=n.entity,r=n.where,[2,new o.query(this,e).softDelete(r)]})})},(r=this).rootGetters.allTrashed=function(t){var e=this;return function(t){return t?new r.query(e,t).allTrashed():r.query.allTrashed(e)}}},t);function t(t,e){this.model=t.Model,this.query=t.Query,this.actions=t.Actions,this.getters=t.Getters,this.rootActions=t.RootActions,this.rootGetters=t.RootGetters,this.config=this.createConfig(e)}return{install:function(t,e){new o(t,e).plugin()}}});